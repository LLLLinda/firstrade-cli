#!/usr/bin/env node
(async () => {
    'use strict';
    const msg = `
usage: firstrade [command]

command:
    login
    getBalance
    getTradeHistory
    getPosition
    placeOrder
    crawlPosition
    crawlTradeHistory

argument:
    --username=username             (required)
    --password=password             (required)
    --pin=pin                       (required)
    --cookies=cookies               (optional)
    `;
    const re = /(?:--(\w+)="?(\w+)"?)/;
    const command = process.argv.find(x => ["login", "getBalance", "getTradeHistory", "getPosition", "placeOrder", "crawlPosition", "crawlTradeHistory"].includes(x))
    const argumentFromLine = process.argv.filter(x => re.test(x)).map(arg => (re.exec(arg) || []).splice(1, 2));
    const argument = Object.fromEntries(argumentFromLine)
    if (command == null || process.argv.includes('-h') || process.argv.includes('--help')) {
        console.log(msg)
    } else {
        const Firstrade = require('../index.js')
        const firstrade = new Firstrade()
        let result = await firstrade[command](argument)
        console.log(JSON.stringify(result))
    }
})()